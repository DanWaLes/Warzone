require 'settings'

function Client_SaveConfigureUI(alert)
	local errMsg;
	local settingValues = {};

	local ret = csc(errMsg, settingValues, getSettings());
	errMsg = ret.errMsg;
	settingValues = ret.settingValues;

	if errMsg then
		return alert(errMsg);
	end

	for settingName, settingValue in pairs(settingValues) do
		Mod.Settings[settingName] = settingValue;
	end
end

function csc(errMsg, settingValues, settings)
	for settingName, setting in pairs(settings) do
		local settingVal;

		if setting.inputType == 'bool' then
			settingVal = GLOBALS[settingName].GetIsChecked();
		else
			settingVal = GLOBALS[settingName].GetValue();

			if settingVal < setting.minValue or settingVal > setting.maxValue then
				if errMsg == nil then
					errMsg = '';
				end

				if errMsg ~= '' then
					errMsg = errMsg .. '\n';
				end

				errMsg = errMsg .. setting.label .. ' must be between ' .. tostring(setting.minValue) .. ' and ' .. tostring(setting.maxValue);
			end
		end

		settingValues[settingName] = settingVal;

		if setting.subsettings then
			csc(errMsg, settingValues, setting.subsettings);
		end
	end

	return {
		errMsg = errMsg,
		settingValues = settingValues
	};
end